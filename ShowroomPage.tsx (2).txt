
import React, { useState, useMemo } from 'react';
import { useI18n } from './lib/contexts/I18nContext';
import { ShowroomItem, Page } from '../types';
import { COMPANY_INFO } from './constants';
import { PlayIcon } from './lib/Icons';

interface ShowroomPageProps {
  items: ShowroomItem[];
  showroomBanner: string;
  setPage: (page: Page) => void;
}

export const ShowroomPage: React.FC<ShowroomPageProps> = ({ items, showroomBanner, setPage }) => {
  const { t, language } = useI18n();
  const [activeSection, setActiveSection] = useState<string>('all');
  const [selectedVideo, setSelectedVideo] = useState<string | null>(null);

  const sections = useMemo(() => {
    const s = Array.from(new Set(items.map(item => language === 'ar' ? item.section_ar : item.section_en)));
    return ['all', ...s.filter(Boolean) as string[]];
  }, [items, language]);

  const filteredItems = useMemo(() => {
    if (activeSection === 'all') return items;
    return items.filter(item => (language === 'ar' ? item.section_ar : item.section_en) === activeSection);
  }, [items, activeSection, language]);

  return (
    <div className="animate-fade-in pb-32">
        {/* Modern Video Hero - Official Delta Stars Film */}
        <section className="relative h-[80vh] flex items-center justify-center overflow-hidden bg-black">
            <iframe 
                src={`https://drive.google.com/file/d/${COMPANY_INFO.official_video_id}/preview?autoplay=1&mute=1`}
                className="absolute inset-0 w-full h-full object-cover opacity-60 scale-125"
                frameBorder="0" 
                allow="autoplay; fullscreen" 
            ></iframe>
            <div className="absolute inset-0 bg-gradient-to-t from-primary via-transparent to-primary/40"></div>
            
            <div className="relative z-10 text-center px-4 max-w-5xl">
                <div className="inline-block bg-secondary text-white px-8 py-3 rounded-full font-black text-sm mb-8 animate-bounce tracking-widest uppercase">
                    {t('showroom.exploreWorld')}
                </div>
                <h1 className="text-6xl md:text-9xl font-black text-white mb-10 tracking-tighter uppercase leading-none">
                    {t('showroom.title')}
                </h1>
                <div className="flex flex-wrap justify-center gap-6">
                    <button 
                        onClick={() => setSelectedVideo(`https://drive.google.com/file/d/${COMPANY_INFO.official_video_id}/preview`)}
                        className="bg-white text-primary px-12 py-5 rounded-[2rem] font-black text-2xl hover:scale-105 transition-all flex items-center gap-4 shadow-2xl"
                    >
                        <span className="text-3xl">ğŸ¬</span> {t('showroom.watchVideo')}
                    </button>
                </div>
            </div>
        </section>

        {/* Dynamic Section Filters */}
        <div className="sticky top-[80px] z-40 bg-white/90 backdrop-blur-xl border-b border-gray-100 shadow-sm py-8">
            <div className="container mx-auto px-4 overflow-x-auto">
                <div className="flex justify-center gap-6 min-w-max">
                    {sections.map(sec => (
                        <button
                            key={sec}
                            onClick={() => setActiveSection(sec)}
                            className={`px-10 py-4 rounded-[2rem] font-black transition-all border-2 text-lg ${activeSection === sec ? 'bg-primary text-white border-primary shadow-xl scale-110' : 'bg-white text-gray-400 border-gray-100 hover:border-primary/30'}`}
                        >
                            {sec === 'all' ? (language === 'ar' ? 'Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„' : 'View All') : sec}
                        </button>
                    ))}
                </div>
            </div>
        </div>

        {/* High-Performance Infinite-Style Gallery */}
        <section className="container mx-auto px-4 py-24">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-16">
                {filteredItems.map(item => (
                    <div key={item.id} className="bg-white rounded-[4rem] shadow-2xl overflow-hidden group border border-gray-100 hover:-translate-y-6 transition-all duration-700 relative">
                        <div className="relative h-96 overflow-hidden">
                            <img src={item.image} alt={item.title_en} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000" />
                            <div className="absolute inset-0 bg-gradient-to-t from-primary/90 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700 flex flex-col justify-end p-10">
                                <p className="text-white font-bold text-lg leading-relaxed">{language === 'ar' ? item.description_ar : item.description_en}</p>
                            </div>
                            {item.videoUrl && (
                                <button 
                                    onClick={() => setSelectedVideo(item.videoUrl || null)}
                                    className="absolute top-8 right-8 bg-white/20 backdrop-blur-md text-white p-5 rounded-full hover:bg-white hover:text-primary transition-all shadow-xl"
                                >
                                    <PlayIcon className="w-8 h-8" />
                                </button>
                            )}
                        </div>
                        <div className="p-12">
                            <span className="text-xs font-black text-secondary uppercase tracking-widest mb-4 block px-6 py-2 bg-secondary/10 w-fit rounded-full">
                                {language === 'ar' ? item.section_ar : item.section_en}
                            </span>
                            <h3 className="text-4xl font-black text-black leading-tight tracking-tighter">{language === 'ar' ? item.title_ar : item.title_en}</h3>
                        </div>
                    </div>
                ))}
            </div>
            
            {/* Call to Action - Promote Corporate Sales */}
            <div className="mt-32 bg-slate-900 text-white p-16 rounded-[4rem] flex flex-col md:flex-row justify-between items-center gap-10 shadow-2xl relative overflow-hidden">
                <div className="absolute top-0 right-0 w-64 h-64 bg-primary/20 blur-3xl rounded-full"></div>
                <div className="relative z-10">
                    <h2 className="text-4xl font-black mb-4 tracking-tighter uppercase">{language === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…Ù…Ø«Ù„ Ù„Ø´Ø±ÙƒØ© Ø£Ùˆ ÙÙ†Ø¯Ù‚ØŸ' : 'Representing a Hotel or Corp?'}</h2>
                    <p className="text-xl font-bold opacity-70">{language === 'ar' ? 'Ø§Ù†Ø¶Ù… Ù„Ø´Ø±ÙƒØ§Ø¦Ù†Ø§ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£Ø³Ø¹Ø§Ø± ØªÙˆØ±ÙŠØ¯ Ø®Ø§ØµØ© ÙˆÙ…Ù…ÙŠØ²Ø§Øª Ø­ØµØ±ÙŠØ©.' : 'Join our partners for exclusive supply pricing and premium features.'}</p>
                </div>
                <button onClick={() => setPage('vipLogin')} className="bg-secondary text-white px-12 py-5 rounded-[2rem] font-black text-2xl hover:scale-110 transition-all shadow-xl whitespace-nowrap">
                    {t('home.hero.vipButton')}
                </button>
            </div>
        </section>

        {/* Advanced Lightbox */}
        {selectedVideo && (
            <div className="fixed inset-0 bg-black/98 z-[200] flex justify-center items-center p-4 md:p-12 animate-fade-in backdrop-blur-2xl">
                <button onClick={() => setSelectedVideo(null)} className="absolute top-10 right-10 text-white hover:text-secondary text-7xl font-black z-[210] transition-colors">&times;</button>
                <div className="w-full max-w-7xl aspect-video rounded-[4rem] overflow-hidden shadow-[0_0_150px_rgba(255,146,43,0.3)] bg-black border-8 border-white/5">
                    <iframe 
                        src={selectedVideo} 
                        className="w-full h-full" 
                        frameBorder="0" 
                        allow="autoplay; fullscreen" 
                        allowFullScreen
                    ></iframe>
                </div>
            </div>
        )}
    </div>
  );
};
